name: Restart Bot

on:
  workflow_dispatch:   # Permite que el reinicio sea manual
    inputs:
      reason:
        description: 'Reason for restart'
        required: true
        type: string

jobs:
  restart:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python 3.x
      uses: actions/setup-python@v2
      with:
        python-version: '3.8'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Borrar mensajes en los canales de respawn y ocupados
      run: |
        echo "Borrando mensajes en los canales de respawn y ocupados..."
        python -c "import discord, os; from discord.ext import commands; from dotenv import load_dotenv; load_dotenv(); token = os.getenv('DISCORD_TOKEN'); client = discord.Client(); @client.event async def on_ready(): respawn_channel = client.get_channel(int(os.getenv('RESPAWN_CHANNEL_ID'))); ocupados_channel = client.get_channel(int(os.getenv('OCUPADOS_CHANNEL_ID'))); await respawn_channel.purge(limit=100); await ocupados_channel.purge(limit=100); print('Mensajes borrados en los canales.'); await client.close(); client.run(token)"

    - name: Reiniciar el bot
      run: |
        echo "Reiniciando el bot..."
        python main.py
